<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/styles.963f95c3e7e25a2f628cb6039fcdfbbf.css"/></head><body class="landing-page"><div id="react-mount"><div data-reactid=".kehaqs9mv4" data-react-checksum="36218899"><nav data-reactid=".kehaqs9mv4.0"><ul class="Nav__items___1oDCD" data-reactid=".kehaqs9mv4.0.0"><li data-reactid=".kehaqs9mv4.0.0.0"><a class="" href="/posts" data-reactid=".kehaqs9mv4.0.0.0.0">Posts</a></li><li data-reactid=".kehaqs9mv4.0.0.1"><a class="" href="/talks" data-reactid=".kehaqs9mv4.0.0.1.0">Talks</a></li><li data-reactid=".kehaqs9mv4.0.0.2"><a class="" href="/books" data-reactid=".kehaqs9mv4.0.0.2.0">Books</a></li><li data-reactid=".kehaqs9mv4.0.0.3"><a class="" href="/projects" data-reactid=".kehaqs9mv4.0.0.3.0">Projects</a></li></ul></nav><div data-reactid=".kehaqs9mv4.1"><div data-reactid=".kehaqs9mv4.1.0"><p>Today I was trying to extract the minimal imports for a module using <code>ghc -ddump-minimal-imports</code> but I was getting this error on some files:</p>
<pre><code>&lt;code class=<span class="hljs-string">"bash"</span>&gt;error: missing binary operator <span class="hljs-keyword">before</span> <span class="hljs-keyword">token</span> <span class="hljs-string">"("</span>
<span class="hljs-comment">#if MIN_VERSION_base(4,4,0)</span>
^```

Which is related <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> fact that `cabal` expands `MIN_VERSION_base` macros when running `cabal build`, so we don’t have them when running `ghc` <span class="hljs-keyword">or</span> `ghci`. Luckily <span class="hljs-keyword">it</span>’s <span class="hljs-keyword">an</span> easy fix.

Cabal generates <span class="hljs-keyword">a</span> macros <span class="hljs-built_in">file</span> <span class="hljs-built_in">relative</span> <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> root <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> project <span class="hljs-keyword">at</span> `dist/build/autogen/cabal_macros.h`. We can <span class="hljs-built_in">include</span> this <span class="hljs-built_in">file</span> <span class="hljs-built_in">to</span> gain access <span class="hljs-built_in">to</span> <span class="hljs-keyword">the</span> macros:

`&lt;code class=<span class="hljs-string">"bash"</span> style=<span class="hljs-string">"overflow-x:auto"</span>&gt;ghc -ddump-minimal-imports -optP-<span class="hljs-built_in">include</span> -optPdist/build/autogen/cabal_macros.h src/Types.hs`

Which will now spit out our imports <span class="hljs-keyword">into</span> <span class="hljs-keyword">a</span> <span class="hljs-built_in">file</span> called `Types.imports` <span class="hljs-keyword">and</span> may look something like this:

</code></pre>
<p><code class="haskell">import Blaze.ByteString.Builder
( Builder, fromLazyByteString, fromByteString )
import Blaze.ByteString.Builder.Char.Utf8
( fromText, fromLazyText )
import Control.Applicative
( Applicative((), pure), Alternative((), empty), () )
import Control.Exception.Lifted
( ErrorCall(…),
Exception,
Handler(…),
SomeException(…),
catch,
catches,
mask,
onException,
throwIO )```</p>
</div></div></div></div><script src="/js/bundle-dc18507cc1e13ceedca9.js"></script></body></html>