<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title data-react-helmet="true">Response Headers with Servant</title><meta data-react-helmet="true" property="description" content="It can be hard to figure out how to deal with all of the type
machinery in Servant. This post details adding headers to the response
of a…"/><meta data-react-helmet="true" property="og:title" content="Response Headers with Servant"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:url" content="http://christopherbiscardi.com/response-headers-with-servant/"/><meta data-react-helmet="true" property="og:description" content="It can be hard to figure out how to deal with all of the type
machinery in Servant. This post details adding headers to the response
of a…"/><meta data-react-helmet="true" property="og:image" content="http://christopherbiscardi.com/0e564987f79346b0e81685c304af3912.png"/><meta data-react-helmet="true" property="twitter:card" content="summary"/><meta data-react-helmet="true" property="twitter:title" content="Response Headers with Servant"/><meta data-react-helmet="true" property="twitter:description" content="It can be hard to figure out how to deal with all of the type
machinery in Servant. This post details adding headers to the response
of a…"/><meta data-react-helmet="true" property="twitter:url" content="http://christopherbiscardi.com/response-headers-with-servant/"/><link rel="stylesheet" type="text/css" href="/styles.f25bf9e6682280946ba2e441a544b407.css"/></head><body class="landing-page"><div id="content"><div data-reactroot="" data-reactid="1" data-react-checksum="-185811365"><div class="Nav__wrapper___u7BUA" data-reactid="2"><nav class="Nav__nav___1e2Pp" data-reactid="3"><a class="Nav__logoWrapper___35yvY" href="/" data-reactid="4"><img class="Nav__logo___sw4O9" src="/69305db2985e926d498b513a21d28383.png" data-reactid="5"/></a><ul class="Nav__items___1oDCD" data-reactid="6"><li data-reactid="7"><a class="Nav__itemLink___H6Isv" href="/posts/" data-reactid="8">Posts</a></li><li data-reactid="9"><a href="https://github.com/ChristopherBiscardi/ama/issues?q=is%3Aissue+is%3Aclosed" class="Nav__itemLink___H6Isv" data-reactid="10">AMA</a></li><li data-reactid="11"><a class="Nav__itemLink___H6Isv" href="/books/" data-reactid="12">Books</a></li><li data-reactid="13"><a class="Nav__itemLink___H6Isv" href="/projects/" data-reactid="14">Projects</a></li><li data-reactid="15"><a class="Nav__itemLink___H6Isv" href="/about/" data-reactid="16">About</a></li></ul></nav></div><div data-reactid="17"><div class="Post__page___15ves" data-reactid="18"><!-- react-empty: 19 --><div class="Post__container___f_rKX" data-reactid="20"><div class="Post__singleColumn___tYK8R" data-reactid="21"><h1 class="Post__title___2I6DZ" data-reactid="22">Response Headers with Servant</h1><div class="Post__meta___1fVoc" data-reactid="23"><!-- react-text: 24 -->Aug 8th, 2016<!-- /react-text --><!-- react-text: 25 --> · <!-- /react-text --><!-- react-text: 26 -->1<!-- /react-text --><!-- react-text: 27 --> minute read<!-- /react-text --></div></div></div><img class="Post__img___VXS1J" src="/0e564987f79346b0e81685c304af3912.png" data-reactid="28"/><div class="Post__container___f_rKX" data-reactid="29"><div class="Post__singleColumn___tYK8R" data-reactid="30"><div data-reactid="31"><p>It can be hard to figure out how to deal with all of the type
machinery in Servant. This post details adding headers to the response
of a Servant API.</p>
<p>Given the following API, which returns NoContent for a GET request.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-class___mOeOV"><span class="highlight__hljs-keyword___som98">type</span> <span class="highlight__hljs-type___11WfV">V2</span> = "v2" :&gt; <span class="highlight__hljs-type___11WfV">Get</span> '[<span class="highlight__hljs-type___11WfV">JSON</span>] <span class="highlight__hljs-type___11WfV">NoContent</span></span>
</code></pre>
<p>and the following handler, which assumes we’ve set up a custom Monad
stack called <code>App</code> (note that we’ve skipped the “server” boilerplate
for brevity, since it is covered in the Servant docs).</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-title___1fl8Q">v2</span> :: <span class="highlight__hljs-type___11WfV">App</span> <span class="highlight__hljs-type___11WfV">NoContent</span>
<span class="highlight__hljs-title___1fl8Q">v2</span> = return <span class="highlight__hljs-type___11WfV">NoContent</span>
</code></pre>
<p>We can add a response header using <a href="http://hackage.haskell.org/package/servant-0.8/docs/Servant-API-ResponseHeaders.html#v:addHeader">addHeader</a>, which is
detailed in the docs on Hackage. What may be less obvious is that
addHeader changes the response type of the route. Our simple API
changes it’s type to represent the new return value:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-class___mOeOV"><span class="highlight__hljs-keyword___som98">type</span> <span class="highlight__hljs-type___11WfV">V2Base</span> = "v2" :&gt; <span class="highlight__hljs-type___11WfV">Get</span> '[<span class="highlight__hljs-type___11WfV">JSON</span>] (<span class="highlight__hljs-type___11WfV">Headers</span> '[<span class="highlight__hljs-type___11WfV">Header</span> "<span class="highlight__hljs-type___11WfV">X</span>-<span class="highlight__hljs-type___11WfV">Awesome</span>" <span class="highlight__hljs-type___11WfV">String</span>] <span class="highlight__hljs-type___11WfV">NoContent</span>)</span>
</code></pre>
<p>and our handler now can return the appropriate type as well:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-title___1fl8Q">v2</span> :: <span class="highlight__hljs-type___11WfV">App</span> (<span class="highlight__hljs-type___11WfV">Headers</span> '[<span class="highlight__hljs-type___11WfV">Header</span> <span class="highlight__hljs-string___1SffY">"X-Awesome"</span> <span class="highlight__hljs-type___11WfV">String</span>] <span class="highlight__hljs-type___11WfV">NoContent</span>)
<span class="highlight__hljs-title___1fl8Q">v2</span> = return $ addHeader <span class="highlight__hljs-string___1SffY">"very/awesome"</span> <span class="highlight__hljs-type___11WfV">NoContent</span>
</code></pre>
<h2 id="multiple-headers">Multiple Headers</h2>
<p>If we inspect the type we added to be able to return our first header,
we can notice that it is a list of <code>Header</code>s. We can use this to add
multiple new headers to our route as follows:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-class___mOeOV"><span class="highlight__hljs-keyword___som98">type</span> <span class="highlight__hljs-type___11WfV">V2Base</span> = "v2" :&gt; <span class="highlight__hljs-type___11WfV">Get</span> '[<span class="highlight__hljs-type___11WfV">JSON</span>] (<span class="highlight__hljs-type___11WfV">Headers</span> '[
  <span class="highlight__hljs-type___11WfV">Header</span> "<span class="highlight__hljs-type___11WfV">X</span>-<span class="highlight__hljs-type___11WfV">Awesome</span>" <span class="highlight__hljs-type___11WfV">String</span>,
  <span class="highlight__hljs-type___11WfV">Header</span> "<span class="highlight__hljs-type___11WfV">Content</span>-<span class="highlight__hljs-type___11WfV">Type</span>" <span class="highlight__hljs-type___11WfV">String</span>
  ] <span class="highlight__hljs-type___11WfV">NoContent</span>)</span>
</code></pre>
</div></div></div></div></div></div></div><script charset="UTF-8">window.__APOLLO_STATE__={"apollo":{"data":{"$ROOT_QUERY.root.post({\"slug\":\"response-headers-with-servant\"})":{"body":"<p>It can be hard to figure out how to deal with all of the type\nmachinery in Servant. This post details adding headers to the response\nof a Servant API.</p>\n<p>Given the following API, which returns NoContent for a GET request.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-class___mOeOV\"><span class=\"highlight__hljs-keyword___som98\">type</span> <span class=\"highlight__hljs-type___11WfV\">V2</span> = \"v2\" :&gt; <span class=\"highlight__hljs-type___11WfV\">Get</span> '[<span class=\"highlight__hljs-type___11WfV\">JSON</span>] <span class=\"highlight__hljs-type___11WfV\">NoContent</span></span>\n</code></pre>\n<p>and the following handler, which assumes we’ve set up a custom Monad\nstack called <code>App</code> (note that we’ve skipped the “server” boilerplate\nfor brevity, since it is covered in the Servant docs).</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-title___1fl8Q\">v2</span> :: <span class=\"highlight__hljs-type___11WfV\">App</span> <span class=\"highlight__hljs-type___11WfV\">NoContent</span>\n<span class=\"highlight__hljs-title___1fl8Q\">v2</span> = return <span class=\"highlight__hljs-type___11WfV\">NoContent</span>\n</code></pre>\n<p>We can add a response header using <a href=\"http://hackage.haskell.org/package/servant-0.8/docs/Servant-API-ResponseHeaders.html#v:addHeader\">addHeader</a>, which is\ndetailed in the docs on Hackage. What may be less obvious is that\naddHeader changes the response type of the route. Our simple API\nchanges it’s type to represent the new return value:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-class___mOeOV\"><span class=\"highlight__hljs-keyword___som98\">type</span> <span class=\"highlight__hljs-type___11WfV\">V2Base</span> = \"v2\" :&gt; <span class=\"highlight__hljs-type___11WfV\">Get</span> '[<span class=\"highlight__hljs-type___11WfV\">JSON</span>] (<span class=\"highlight__hljs-type___11WfV\">Headers</span> '[<span class=\"highlight__hljs-type___11WfV\">Header</span> \"<span class=\"highlight__hljs-type___11WfV\">X</span>-<span class=\"highlight__hljs-type___11WfV\">Awesome</span>\" <span class=\"highlight__hljs-type___11WfV\">String</span>] <span class=\"highlight__hljs-type___11WfV\">NoContent</span>)</span>\n</code></pre>\n<p>and our handler now can return the appropriate type as well:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-title___1fl8Q\">v2</span> :: <span class=\"highlight__hljs-type___11WfV\">App</span> (<span class=\"highlight__hljs-type___11WfV\">Headers</span> '[<span class=\"highlight__hljs-type___11WfV\">Header</span> <span class=\"highlight__hljs-string___1SffY\">\"X-Awesome\"</span> <span class=\"highlight__hljs-type___11WfV\">String</span>] <span class=\"highlight__hljs-type___11WfV\">NoContent</span>)\n<span class=\"highlight__hljs-title___1fl8Q\">v2</span> = return $ addHeader <span class=\"highlight__hljs-string___1SffY\">\"very/awesome\"</span> <span class=\"highlight__hljs-type___11WfV\">NoContent</span>\n</code></pre>\n<h2 id=\"multiple-headers\">Multiple Headers</h2>\n<p>If we inspect the type we added to be able to return our first header,\nwe can notice that it is a list of <code>Header</code>s. We can use this to add\nmultiple new headers to our route as follows:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-class___mOeOV\"><span class=\"highlight__hljs-keyword___som98\">type</span> <span class=\"highlight__hljs-type___11WfV\">V2Base</span> = \"v2\" :&gt; <span class=\"highlight__hljs-type___11WfV\">Get</span> '[<span class=\"highlight__hljs-type___11WfV\">JSON</span>] (<span class=\"highlight__hljs-type___11WfV\">Headers</span> '[\n  <span class=\"highlight__hljs-type___11WfV\">Header</span> \"<span class=\"highlight__hljs-type___11WfV\">X</span>-<span class=\"highlight__hljs-type___11WfV\">Awesome</span>\" <span class=\"highlight__hljs-type___11WfV\">String</span>,\n  <span class=\"highlight__hljs-type___11WfV\">Header</span> \"<span class=\"highlight__hljs-type___11WfV\">Content</span>-<span class=\"highlight__hljs-type___11WfV\">Type</span>\" <span class=\"highlight__hljs-type___11WfV\">String</span>\n  ] <span class=\"highlight__hljs-type___11WfV\">NoContent</span>)</span>\n</code></pre>\n","attributes":{"type":"id","id":"$ROOT_QUERY.root.post({\"slug\":\"response-headers-with-servant\"}).attributes","generated":true},"__typename":"BlogPost"},"$ROOT_QUERY.root.post({\"slug\":\"response-headers-with-servant\"}).attributes":{"title":"Response Headers with Servant","updatedAt":"Aug 8th, 2016","publishedAt":"Aug 8th, 2016","timeToRead":1,"headerImage":"/0e564987f79346b0e81685c304af3912.png","url":"/response-headers-with-servant/","canonicalURL":null,"excerpt":"It can be hard to figure out how to deal with all of the type\nmachinery in Servant. This post details adding headers to the response\nof a…","__typename":"BlogPostAttributes"},"$ROOT_QUERY.root":{"post({\"slug\":\"response-headers-with-servant\"})":{"type":"id","id":"$ROOT_QUERY.root.post({\"slug\":\"response-headers-with-servant\"})","generated":true},"__typename":"Query"},"ROOT_QUERY":{"root":{"type":"id","id":"$ROOT_QUERY.root","generated":true}}}}};</script><script src="/js/client.js" charset="UTF-8"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-46878058-1', 'auto');
          ga('send', 'pageview');</script></body></html>