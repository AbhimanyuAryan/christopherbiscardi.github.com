{"data":{"post":{"body":"<p>In this post we will be replacing the JSON file (for user authentication) with a Postgres database.</p>\n<p><a href=\"https://github.com/ChristopherBiscardi/Getting-Started-with-Snap-and-User-Authentication/commit/72a77abac5d46554e659ddeef0a1abf7074a5c6f\">Git Diff and Repo</a><br>\n<a href=\"http://www.christopherbiscardi.com/2014/01/07/getting-started-with-snap-and-user-authentication-part-1/\">part 1</a><br>\n<a href=\"http://www.christopherbiscardi.com/2014/01/10/getting-started-with-snap-and-user-authentication-part-2/\">part 2</a></p>\n<p>In <code>abc.cabal</code> add <code>snaplet-postgresql-simple</code> to <code>Build-depends</code>:</p>\n<pre><code>&lt;code <span class=\"hljs-keyword\">class</span>=<span class=\"hljs-string\">\"haskell\"</span>&gt;Build-depends:\n    bytestring                &gt;= <span class=\"hljs-number\">0.9</span><span class=\"hljs-number\">.1</span>   &amp;&amp; = <span class=\"hljs-number\">0.12</span>    &amp;&amp; = <span class=\"hljs-number\">0.2</span><span class=\"hljs-number\">.1</span>   &amp;&amp; = <span class=\"hljs-number\">2</span>       &amp;&amp; = <span class=\"hljs-number\">0.11</span>    &amp;&amp; = <span class=\"hljs-number\">0.9</span>     &amp;&amp; = <span class=\"hljs-number\">0.9</span>     &amp;&amp; = <span class=\"hljs-number\">0.9</span>     &amp;&amp; = <span class=\"hljs-number\">0.11</span>    &amp;&amp; = <span class=\"hljs-number\">1.1</span>     &amp;&amp; = <span class=\"hljs-number\">0.1</span>,\n    snaplet-postgresql-simple == <span class=\"hljs-number\">0.4</span><span class=\"hljs-number\">.1</span>```\n\n<span class=\"hljs-keyword\">Then</span>, <span class=\"hljs-keyword\">In</span> `src/Site.hs` we’re going <span class=\"hljs-keyword\">to</span> add the following <span class=\"hljs-keyword\">imports</span>:\n\n</code></pre>\n<p><code class=\"haskell\">import Snap.Snaplet.PostgresqlSimple\nimport Snap.Snaplet.Auth.Backends.PostgresqlSimple```</p>\n<p>add this line to initialize the database in our Application Initialization code below session and about auth:</p>\n<p><code>d</code></p>\n<p>and replace this line:</p>\n<p><code>initJsonFileAuthManager defAuthSettings sess &quot;users.json&quot;</code></p>\n<p>with this line, which does the dirty work of using Postgres instead of a JSON file.</p>\n<p><code>initPostgresAuth sess d</code></p>\n<p>We’ll also add the initialized database snaplet to our returned App:</p>\n<p><code>return $ App h s d a</code></p>\n<p>We’re almost done, but first we’ll need to add <code>_db</code> to our App definition in <code>src/Application.hs</code>:</p>\n<pre><code>&lt;code <span class=\"hljs-built_in\">class</span>=<span class=\"hljs-string\">\"haskell\"</span>&gt;data App = App\n    { _heist :: Snaplet (Heist App)\n    , _sess :: Snaplet SessionManager\n    , _db :: Snaplet Postgres\n    , _auth :: Snaplet (AuthManager App)\n    }```\n\n<span class=\"hljs-keyword\">and</span> don't forget <span class=\"hljs-keyword\">the</span> import <span class=\"hljs-keyword\">for</span> postgres <span class=\"hljs-keyword\">in</span> <span class=\"hljs-keyword\">the</span> same <span class=\"hljs-built_in\">file</span>.\n\n`import Snap.Snaplet.PostgresqlSimple`\n\nWe are now using Postgres <span class=\"hljs-keyword\">as</span> a database <span class=\"hljs-keyword\">for</span> our authentication! `cabal install` <span class=\"hljs-keyword\">and</span> <span class=\"hljs-built_in\">run</span> `abc` <span class=\"hljs-keyword\">to</span> make sure <span class=\"hljs-keyword\">it</span> works. You may need <span class=\"hljs-keyword\">to</span> <span class=\"hljs-built_in\">run</span> <span class=\"hljs-keyword\">the</span> following <span class=\"hljs-keyword\">in</span> `psql`:\n\n</code></pre>\n<p><code class=\"psql\">CREATE ROLE postgres LOGIN;\nCREATE DATABASE testdb;```</p>\n<p>also of note is that the git repo has bumped the version of abc to <code>0.2</code></p>\n<p><a href=\"http://www.christopherbiscardi.com/2014/01/07/getting-started-with-snap-and-user-authentication-part-1/\">Part 1 - Beginnings</a><br>\n<a href=\"http://www.christopherbiscardi.com/2014/01/10/getting-started-with-snap-and-user-authentication-part-2/\">Part 2 - Auth</a></p>\n<p><a href=\"http://res.cloudinary.com/diqzbm8lz/image/upload/v1428611521/CBLogo_2014_transparent_swcmig.png\"><img src=\"http://res.cloudinary.com/diqzbm8lz/image/upload/h_300,w_300/v1428611521/CBLogo_2014_transparent_swcmig.png\" alt=\"CBLogo_2014_transparent\"></a></p>\n"}}}