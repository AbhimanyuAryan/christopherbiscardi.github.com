<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title data-react-helmet="true">Snap, Postgres and Heist: Displaying Data from Queries</title><meta data-react-helmet="true" property="description" content="The github repo for this post is here."/><meta data-react-helmet="true" property="og:title" content="Snap, Postgres and Heist: Displaying Data from Queries"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:url" content="http://christopherbiscardi.com/2014/4/8/snap-postgres-and-heist-displaying-data-from-queries/"/><meta data-react-helmet="true" property="og:description" content="The github repo for this post is here."/><meta data-react-helmet="true" property="og:image" content="http://christopherbiscardi.comnull"/><meta data-react-helmet="true" property="twitter:card" content="summary"/><meta data-react-helmet="true" property="twitter:title" content="Snap, Postgres and Heist: Displaying Data from Queries"/><meta data-react-helmet="true" property="twitter:description" content="The github repo for this post is here."/><meta data-react-helmet="true" property="twitter:url" content="http://christopherbiscardi.com/2014/4/8/snap-postgres-and-heist-displaying-data-from-queries/"/><link rel="stylesheet" type="text/css" href="/styles.f25bf9e6682280946ba2e441a544b407.css"/></head><body class="landing-page"><div id="content"><div data-reactroot="" data-reactid="1" data-react-checksum="712149570"><div class="Nav__wrapper___u7BUA" data-reactid="2"><nav class="Nav__nav___1e2Pp" data-reactid="3"><a class="Nav__logoWrapper___35yvY" href="/" data-reactid="4"><img class="Nav__logo___sw4O9" src="/69305db2985e926d498b513a21d28383.png" data-reactid="5"/></a><ul class="Nav__items___1oDCD" data-reactid="6"><li data-reactid="7"><a class="Nav__itemLink___H6Isv" href="/posts/" data-reactid="8">Posts</a></li><li data-reactid="9"><a href="https://github.com/ChristopherBiscardi/ama/issues?q=is%3Aissue+is%3Aclosed" class="Nav__itemLink___H6Isv" data-reactid="10">AMA</a></li><li data-reactid="11"><a class="Nav__itemLink___H6Isv" href="/books/" data-reactid="12">Books</a></li><li data-reactid="13"><a class="Nav__itemLink___H6Isv" href="/projects/" data-reactid="14">Projects</a></li><li data-reactid="15"><a class="Nav__itemLink___H6Isv" href="/about/" data-reactid="16">About</a></li></ul></nav></div><div data-reactid="17"><div class="Post__page___15ves" data-reactid="18"><!-- react-empty: 19 --><div class="Post__container___f_rKX" data-reactid="20"><div class="Post__singleColumn___tYK8R" data-reactid="21"><h1 class="Post__title___2I6DZ" data-reactid="22">Snap, Postgres and Heist: Displaying Data from Queries</h1><div class="Post__meta___1fVoc" data-reactid="23"><!-- react-text: 24 -->Apr 8th, 2014<!-- /react-text --><!-- react-text: 25 --> · <!-- /react-text --><!-- react-text: 26 -->2<!-- /react-text --><!-- react-text: 27 --> minute read<!-- /react-text --></div></div></div><div class="Post__container___f_rKX" data-reactid="28"><div class="Post__singleColumn___tYK8R" data-reactid="29"><div data-reactid="30"><p>The github repo for this post is <a href="https://github.com/ChristopherBiscardi/snap-postgres-heist">here</a>.</p>
<h2 id="single-authuser-splice">Single AuthUser Splice</h2>
<p>Assuming we have instances and initializations for the Postgres Auth backend and Postgresql-Simple Snaplet, we can do a few things. First, we need to write a Splice for the AuthUser data type. We will only use a couple fields to show how it works.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;authUserSplice :: Monad m =&gt;
                  AuthUser -&gt;
                  Splices (HeistT n m Template)
authUserSplice authUser = do
  &quot;userLogin&quot; ## I.textSplice (userLogin authUser)
  &quot;userLoginCount&quot; ## I.textSplice (T.pack $ show $ userLoginCount authUser)
</code></pre>
<p>Using <code>##</code>, we are binding the strings <code>&quot;userLogin&quot;</code> and <code>&quot;userLoginCount&quot;</code> to their respective values from the <code>authUser</code> object. <code>userLogin authUser</code> gives us a <code>Text</code> result, so <code>&quot;userLogin&quot;</code> is bound to a text splice. We also bind <code>&quot;userLoginCount&quot;</code> as a text splice by converting the <code>int</code> we get from using <code>userLoginCount</code> on <code>authUser</code>.</p>
<p>Now that we have our Splice written, let’s write our template.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>&lt;code class=&quot;html&quot;&gt;&lt;apply template=&quot;base&quot;&gt;
&lt;h1&gt;&lt;userLogin/&gt;&lt;/h1&gt;
&lt;p&gt;Number of Times Logged In: &lt;userLoginCount/&gt;&lt;/p&gt;
&lt;/apply&gt;```

Nothing major here. We have used the strings we bound before as tags to display the text from the `authUser` object.

Finally, we can write a Handler to make the database request and render the template using our splice.

</code></pre>
<p><code class="haskell" style="overflow-x:auto">getFromPostgres :: Handler App (AuthManager App) ()
getFromPostgres = do
result ```</p>
<p>Using a simple query to store the data from Postgres in <code>result</code>, we then render using our template (<code>auth_user_splice.tpl</code>) and apply the splice to the data in our result.</p>
<h2 id="list-of-authusers">List of AuthUsers</h2>
<p>To display a list of data, the process is very similar.</p>
<p>We can reuse the <code>authUserSplice</code> we just wrote and map it across the list of data we plan on passing in using <code>mapSplices</code> and <code>runChildrenWith</code>.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;authUsersSplice  :: [AuthUser] -&gt; I.Splice AppHandler
authUsersSplice = I.mapSplices (I.runChildrenWith . authUserSplice)```

We will also write a new template to display the information. Included in this is the `authUsers` tag, which we are going to bind in our Handler.

</code></pre>
<p><code class="html"><apply template="base"></p>
<dl>
<authUsers>
<dt><userLogin/></dt>
<dd>Number of Times Logged In: <userLoginCount/></dd>
</authUsers>
</dl>
</apply>```
<p>We can then write our handler as such:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;getManyFromPostgres :: Handler App (AuthManager App) ()
getManyFromPostgres = do
        results ```

We are rendering our new template `auth_users_splice.tpl` with our mapped splices bound to `&quot;authUsers&quot;`. The code inside of `&lt;authUsers&gt;` will be run for each result in our list.


## End

That's it. Feel free to pull the code from [github](https://github.com/ChristopherBiscardi/snap-postgres-heist) and leave any questions you have below.
</code></pre>
</div></div></div></div></div></div></div><script charset="UTF-8">window.__APOLLO_STATE__={"apollo":{"data":{"$ROOT_QUERY.root.post({\"slug\":\"snap-postgres-and-heist-displaying-data-from-queries\"})":{"body":"<p>The github repo for this post is <a href=\"https://github.com/ChristopherBiscardi/snap-postgres-heist\">here</a>.</p>\n<h2 id=\"single-authuser-splice\">Single AuthUser Splice</h2>\n<p>Assuming we have instances and initializations for the Postgres Auth backend and Postgresql-Simple Snaplet, we can do a few things. First, we need to write a Splice for the AuthUser data type. We will only use a couple fields to show how it works.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;authUserSplice :: Monad m =&gt;\n                  AuthUser -&gt;\n                  Splices (HeistT n m Template)\nauthUserSplice authUser = do\n  &quot;userLogin&quot; ## I.textSplice (userLogin authUser)\n  &quot;userLoginCount&quot; ## I.textSplice (T.pack $ show $ userLoginCount authUser)\n</code></pre>\n<p>Using <code>##</code>, we are binding the strings <code>&quot;userLogin&quot;</code> and <code>&quot;userLoginCount&quot;</code> to their respective values from the <code>authUser</code> object. <code>userLogin authUser</code> gives us a <code>Text</code> result, so <code>&quot;userLogin&quot;</code> is bound to a text splice. We also bind <code>&quot;userLoginCount&quot;</code> as a text splice by converting the <code>int</code> we get from using <code>userLoginCount</code> on <code>authUser</code>.</p>\n<p>Now that we have our Splice written, let’s write our template.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>&lt;code class=&quot;html&quot;&gt;&lt;apply template=&quot;base&quot;&gt;\n&lt;h1&gt;&lt;userLogin/&gt;&lt;/h1&gt;\n&lt;p&gt;Number of Times Logged In: &lt;userLoginCount/&gt;&lt;/p&gt;\n&lt;/apply&gt;```\n\nNothing major here. We have used the strings we bound before as tags to display the text from the `authUser` object.\n\nFinally, we can write a Handler to make the database request and render the template using our splice.\n\n</code></pre>\n<p><code class=\"haskell\" style=\"overflow-x:auto\">getFromPostgres :: Handler App (AuthManager App) ()\ngetFromPostgres = do\nresult ```</p>\n<p>Using a simple query to store the data from Postgres in <code>result</code>, we then render using our template (<code>auth_user_splice.tpl</code>) and apply the splice to the data in our result.</p>\n<h2 id=\"list-of-authusers\">List of AuthUsers</h2>\n<p>To display a list of data, the process is very similar.</p>\n<p>We can reuse the <code>authUserSplice</code> we just wrote and map it across the list of data we plan on passing in using <code>mapSplices</code> and <code>runChildrenWith</code>.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;authUsersSplice  :: [AuthUser] -&gt; I.Splice AppHandler\nauthUsersSplice = I.mapSplices (I.runChildrenWith . authUserSplice)```\n\nWe will also write a new template to display the information. Included in this is the `authUsers` tag, which we are going to bind in our Handler.\n\n</code></pre>\n<p><code class=\"html\"><apply template=\"base\"></p>\n<dl>\n<authUsers>\n<dt><userLogin/></dt>\n<dd>Number of Times Logged In: <userLoginCount/></dd>\n</authUsers>\n</dl>\n</apply>```\n<p>We can then write our handler as such:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;getManyFromPostgres :: Handler App (AuthManager App) ()\ngetManyFromPostgres = do\n        results ```\n\nWe are rendering our new template `auth_users_splice.tpl` with our mapped splices bound to `&quot;authUsers&quot;`. The code inside of `&lt;authUsers&gt;` will be run for each result in our list.\n\n\n## End\n\nThat's it. Feel free to pull the code from [github](https://github.com/ChristopherBiscardi/snap-postgres-heist) and leave any questions you have below.\n</code></pre>\n","attributes":{"type":"id","id":"$ROOT_QUERY.root.post({\"slug\":\"snap-postgres-and-heist-displaying-data-from-queries\"}).attributes","generated":true},"__typename":"BlogPost"},"$ROOT_QUERY.root.post({\"slug\":\"snap-postgres-and-heist-displaying-data-from-queries\"}).attributes":{"title":"Snap, Postgres and Heist: Displaying Data from Queries","updatedAt":"Apr 8th, 2014","publishedAt":"Apr 8th, 2014","timeToRead":2,"headerImage":null,"url":"/2014/4/8/snap-postgres-and-heist-displaying-data-from-queries/","canonicalURL":null,"excerpt":"The github repo for this post is here.","__typename":"BlogPostAttributes"},"$ROOT_QUERY.root":{"post({\"slug\":\"snap-postgres-and-heist-displaying-data-from-queries\"})":{"type":"id","id":"$ROOT_QUERY.root.post({\"slug\":\"snap-postgres-and-heist-displaying-data-from-queries\"})","generated":true},"__typename":"Query"},"ROOT_QUERY":{"root":{"type":"id","id":"$ROOT_QUERY.root","generated":true}}}}};</script><script src="/js/client.js" charset="UTF-8"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-46878058-1', 'auto');
          ga('send', 'pageview');</script></body></html>