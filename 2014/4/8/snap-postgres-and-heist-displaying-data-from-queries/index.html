<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" type="text/css" href="/styles.9d56a516f70356a9b04feaf105275e9d.css"/></head><body class="landing-page"><div id="react-mount"><div data-reactid=".7sbgxwi734" data-react-checksum="1179730458"><div class="Nav__wrapper___u7BUA" data-reactid=".7sbgxwi734.0"><nav class="Nav__nav___1e2Pp" data-reactid=".7sbgxwi734.0.0"><a class="Nav__logoWrapper___35yvY" href="/" data-reactid=".7sbgxwi734.0.0.0"><img class="Nav__logo___sw4O9" src="/69305db2985e926d498b513a21d28383.png" data-reactid=".7sbgxwi734.0.0.0.0"/></a><ul class="Nav__items___1oDCD" data-reactid=".7sbgxwi734.0.0.1"><li data-reactid=".7sbgxwi734.0.0.1.0"><a class="Nav__itemLink___H6Isv" href="/posts" data-reactid=".7sbgxwi734.0.0.1.0.0">Posts</a></li><li data-reactid=".7sbgxwi734.0.0.1.1"><a href="https://github.com/ChristopherBiscardi/ama" class="Nav__itemLink___H6Isv" data-reactid=".7sbgxwi734.0.0.1.1.0">AMA</a></li><li data-reactid=".7sbgxwi734.0.0.1.2"><a class="Nav__itemLink___H6Isv" href="/books" data-reactid=".7sbgxwi734.0.0.1.2.0">Books</a></li><li data-reactid=".7sbgxwi734.0.0.1.3"><a class="Nav__itemLink___H6Isv" href="/projects" data-reactid=".7sbgxwi734.0.0.1.3.0">Projects</a></li></ul></nav></div><div data-reactid=".7sbgxwi734.1"><div class="Post__container___3xG6t" data-reactid=".7sbgxwi734.1.0"><div class="Post__singleColumn___3RGaV" data-reactid=".7sbgxwi734.1.0.0"><h1 class="Post__title___1k3xj" data-reactid=".7sbgxwi734.1.0.0.0">Snap, Postgres and Heist: Displaying Data from Queries</h1><div class="Post__meta___1jyEB" data-reactid=".7sbgxwi734.1.0.0.1"><span data-reactid=".7sbgxwi734.1.0.0.1.0">Apr 8th, 2014</span><span data-reactid=".7sbgxwi734.1.0.0.1.1"> · </span><span data-reactid=".7sbgxwi734.1.0.0.1.2">2</span><span data-reactid=".7sbgxwi734.1.0.0.1.3"> minute read</span></div><div data-reactid=".7sbgxwi734.1.0.0.2"><p>The github repo for this post is <a href="https://github.com/ChristopherBiscardi/snap-postgres-heist">here</a>.</p>
<h2 id="single-authuser-splice">Single AuthUser Splice</h2>
<p>Assuming we have instances and initializations for the Postgres Auth backend and Postgresql-Simple Snaplet, we can do a few things. First, we need to write a Splice for the AuthUser data type. We will only use a couple fields to show how it works.</p>
<pre class="hljs"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;authUserSplice :: Monad m =&gt;
                  AuthUser -&gt;
                  Splices (HeistT n m Template)
authUserSplice authUser = do
  &quot;userLogin&quot; ## I.textSplice (userLogin authUser)
  &quot;userLoginCount&quot; ## I.textSplice (T.pack $ show $ userLoginCount authUser)
</code></pre>
<p>Using <code>##</code>, we are binding the strings <code>&quot;userLogin&quot;</code> and <code>&quot;userLoginCount&quot;</code> to their respective values from the <code>authUser</code> object. <code>userLogin authUser</code> gives us a <code>Text</code> result, so <code>&quot;userLogin&quot;</code> is bound to a text splice. We also bind <code>&quot;userLoginCount&quot;</code> as a text splice by converting the <code>int</code> we get from using <code>userLoginCount</code> on <code>authUser</code>.</p>
<p>Now that we have our Splice written, let’s write our template.</p>
<pre class="hljs"><code>&lt;code class=&quot;html&quot;&gt;&lt;apply template=&quot;base&quot;&gt;
&lt;h1&gt;&lt;userLogin/&gt;&lt;/h1&gt;
&lt;p&gt;Number of Times Logged In: &lt;userLoginCount/&gt;&lt;/p&gt;
&lt;/apply&gt;```

Nothing major here. We have used the strings we bound before as tags to display the text from the `authUser` object.

Finally, we can write a Handler to make the database request and render the template using our splice.

</code></pre>
<p><code class="haskell" style="overflow-x:auto">getFromPostgres :: Handler App (AuthManager App) ()
getFromPostgres = do
result ```</p>
<p>Using a simple query to store the data from Postgres in <code>result</code>, we then render using our template (<code>auth_user_splice.tpl</code>) and apply the splice to the data in our result.</p>
<h2 id="list-of-authusers">List of AuthUsers</h2>
<p>To display a list of data, the process is very similar.</p>
<p>We can reuse the <code>authUserSplice</code> we just wrote and map it across the list of data we plan on passing in using <code>mapSplices</code> and <code>runChildrenWith</code>.</p>
<pre class="hljs"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;authUsersSplice  :: [AuthUser] -&gt; I.Splice AppHandler
authUsersSplice = I.mapSplices (I.runChildrenWith . authUserSplice)```

We will also write a new template to display the information. Included in this is the `authUsers` tag, which we are going to bind in our Handler.

</code></pre>
<p><code class="html"><apply template="base"></p>
<dl>
<authUsers>
<dt><userLogin/></dt>
<dd>Number of Times Logged In: <userLoginCount/></dd>
</authUsers>
</dl>
</apply>```
<p>We can then write our handler as such:</p>
<pre class="hljs"><code>&lt;code class=&quot;haskell&quot; style=&quot;overflow-x:auto&quot;&gt;getManyFromPostgres :: Handler App (AuthManager App) ()
getManyFromPostgres = do
        results ```

We are rendering our new template `auth_users_splice.tpl` with our mapped splices bound to `&quot;authUsers&quot;`. The code inside of `&lt;authUsers&gt;` will be run for each result in our list.


## End

That's it. Feel free to pull the code from [github](https://github.com/ChristopherBiscardi/snap-postgres-heist) and leave any questions you have below.
</code></pre>
</div></div></div></div></div></div><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-46878058-1', 'auto');
          ga('send', 'pageview');</script></body></html>