<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="user-scalable=no width=device-width, initial-scale=1.0 maximum-scale=1.0"><title></title><link rel="shortcut icon"><link href="https://fonts.googleapis.com/css?family=Crimson+Text|Montserrat:700" rel="stylesheet" type="text/css"><link href="/style.css" rel="stylesheet" type="text/css"></head><body class="landing-page"><div id="react-mount"><div data-reactid=".rzwz1jbjsw" data-react-checksum="-621305727"><nav data-reactid=".rzwz1jbjsw.1"><div data-reactid=".rzwz1jbjsw.1.0"><div data-reactid=".rzwz1jbjsw.1.0.0"><ul data-reactid=".rzwz1jbjsw.1.0.0.0"><li data-reactid=".rzwz1jbjsw.1.0.0.0.0"><a class="" href="/" data-reactid=".rzwz1jbjsw.1.0.0.0.0.0">chrisbiscardi</a></li><li data-reactid=".rzwz1jbjsw.1.0.0.0.1"><a class="" href="/talks" data-reactid=".rzwz1jbjsw.1.0.0.0.1.0">talks</a></li><li data-reactid=".rzwz1jbjsw.1.0.0.0.2"><a href="https://twitter.com/chrisbiscardi" data-reactid=".rzwz1jbjsw.1.0.0.0.2.0">twitter</a></li><li data-reactid=".rzwz1jbjsw.1.0.0.0.3"><a class="" href="/projects" data-reactid=".rzwz1jbjsw.1.0.0.0.3.0">projects</a></li><li data-reactid=".rzwz1jbjsw.1.0.0.0.4"><a class="" href="/books" data-reactid=".rzwz1jbjsw.1.0.0.0.4.0">books</a></li></ul></div></div></nav><div data-reactid=".rzwz1jbjsw.2"><div data-reactid=".rzwz1jbjsw.2.1"><div data-reactid=".rzwz1jbjsw.2.1.0"><div class="markdown" data-reactid=".rzwz1jbjsw.2.1.0.0"><div data-reactid=".rzwz1jbjsw.2.1.0.0.0"><p>In this post we will examine an example app in which we make a RoboSpice request using GoogleHttpClient.</p>
<p>The github repo is <a href="https://github.com/ChristopherBiscardi/robospice-googlehttpclient-example">here</a>.</p>
<h2>Dependencies</h2>
<p>First, we need to grab the RoboSpice dependency JARs from the <code>repository</code> repo.</p>
<p><code>&lt;code class=&quot;bash&quot;&gt;git clone https://github.com/octo-online/robospice/tree/repository</code></p>
<p>Inside of <a href="https://github.com/octo-online/robospice/tree/repository/dependencies/1.4.11/robospice-google-http-client">1.4.11/robospice-google-http-client</a> are the JARs we need to include in the project. If you are using Eclipse copy the JARs into your <code>libs/</code> folder and add them to the build path in <code>Project -&gt; Properties -&gt; Libraries</code> by clicking <code>Add JARs</code>. You may also need to click the <code>Order and Export</code> tab, check their boxes and move the included JARs to the top.</p>
<p>We will also need one JAR from the Google-Http-Lib <a href="https://code.google.com/p/google-http-java-client/wiki/Setup#Download_Library_with_Dependencies">source</a>. It is <code>google-http-client-1.17.0</code>. Again, if using Eclipse, add it to your project in the same way.</p>
<h2>Classes</h2>
<p>We are going to create a few files:</p>
<ul>
<li><a href="#spice-base">BaseSpiceActivity.java</a></li>
<li><a href="#spice-reddit">Reddit*.java</a></li>
<li><a href="#spice-request-reddit">SpiceRequestReddit.java</a></li>
</ul>
<h4>BaseSpiceActivity</h4>
<pre><code>&lt;code <span class="hljs-keyword">class</span>=<span class="hljs-string">"java"</span>&gt;import com.octo.android.robospice.JacksonGoogleHttpClientSpiceService;
import com.octo.android.robospice.SpiceManager;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">BaseSpiceActivity</span> <span class="hljs-title">extends</span> <span class="hljs-title">Activity</span> {
    <span class="hljs-keyword">private</span> SpiceManager spiceManager = <span class="hljs-keyword">new</span> SpiceManager(JacksonGoogleHttpClientSpiceService.class);

    @<span class="hljs-function">Override
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStart</span>(<span class="hljs-params"></span>) </span>{
        spiceManager.start(<span class="hljs-keyword">this</span>);
        super.onStart();
    }

    @<span class="hljs-function">Override
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStop</span>(<span class="hljs-params"></span>) </span>{
        spiceManager.shouldStop();
        super.onStop();
    }

    <span class="hljs-function"><span class="hljs-keyword">protected</span> SpiceManager <span class="hljs-title">getSpiceManager</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> spiceManager;
    }

}```

The big thing we’re doing <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span> file <span class="hljs-keyword">is</span> creating an instance of `SpiceManager` <span class="hljs-function">that will be accessible <span class="hljs-keyword">in</span> the activities that inherit <span class="hljs-keyword">from</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">base</span> <span class="hljs-title">class</span> (<span class="hljs-params">like our `MainActivity.java` will</span>).

We then start `spiceManager` <span class="hljs-keyword">in</span> `<span class="hljs-title">onStart</span>(<span class="hljs-params"></span>)` and stop it <span class="hljs-keyword">in</span> `onStop`. This will ensure that our activities have a `SpiceManager` accessible <span class="hljs-keyword">when</span> they start and clean up after themselves <span class="hljs-keyword">when</span> they stop.

The final piece <span class="hljs-keyword">is</span> a getter <span class="hljs-title">function</span> (<span class="hljs-params">`getSpiceManager(</span>)`) so that we have easy access to the `spiceManager` <span class="hljs-keyword">in</span> our activities.

#### Reddit*.java

We will be getting our data <span class="hljs-keyword">from</span> Reddit, so we first need to examine the responses we’re going to <span class="hljs-keyword">get</span>. I’ve chosen a subreddit <span class="hljs-keyword">where</span> all the posts are very <span class="hljs-title">similar</span> (<span class="hljs-params">/r/Riak</span>). Here <span class="hljs-keyword">is</span> a sample API response:

</span></code></pre>
<p><code class="JavaScript">{
“kind”:“Listing”,
“data”:{
“modhash”:“3mxugaulcd1f8b500be09”,
“children”:[
{
“kind”:“t3”,
“data”:{
“domain”:&quot;<a href="http://github.com">github.com</a>&quot;,
“banned_by”:null,
“media_embed”:{</p>
<pre><code>           },
           &quot;subreddit&quot;:&quot;Riak&quot;,
           &quot;selftext_html&quot;:null,
           &quot;selftext&quot;:&quot;&quot;,
           &quot;likes&quot;:null,
           &quot;secure_media&quot;:null,
           &quot;link_flair_text&quot;:null,
           &quot;id&quot;:&quot;19v60r&quot;,
           &quot;secure_media_embed&quot;:{

           },
           &quot;clicked&quot;:false,
           &quot;stickied&quot;:false,
           &quot;author&quot;:&quot;BonzoESC&quot;,
           &quot;media&quot;:null,
           &quot;score&quot;:1,
           &quot;approved_by&quot;:null,
           &quot;over_18&quot;:false,
           &quot;hidden&quot;:false,
           &quot;thumbnail&quot;:&quot;&quot;,
           &quot;subreddit_id&quot;:&quot;t5_2s3vw&quot;,
           &quot;edited&quot;:false,
           &quot;link_flair_css_class&quot;:null,
           &quot;author_flair_css_class&quot;:null,
           &quot;downs&quot;:0,
           &quot;saved&quot;:false,
           &quot;is_self&quot;:false,
           &quot;permalink&quot;:&quot;/r/Riak..riak/&quot;,
           &quot;name&quot;:&quot;t3_19v60r&quot;,
           &quot;created&quot;:1362687827.0,
           &quot;url&quot;:&quot;https://github.com/basho/riak_dt&quot;,
           &quot;author_flair_text&quot;:null,
           &quot;title&quot;:&quot;riak_dt: CRDT for Riak&quot;,
           &quot;created_utc&quot;:1362687827.0,
           &quot;ups&quot;:1,
           &quot;num_comments&quot;:0,
           &quot;visited&quot;:false,
           &quot;num_reports&quot;:null,
           &quot;distinguished&quot;:null
        }
     }
  ],
  &quot;after&quot;:null,
  &quot;before&quot;:null
</code></pre>
<p>}
}```</p>
<p>We will create a few classes to model the data. The first being <code>Reddit.java</code>.</p>
<p>In <code>Reddit.java</code> we include the keys <code>kind</code> and <code>data</code> using <code>@Key</code> declarations. Then we declare their types.</p>
<pre><code>&lt;code <span class="hljs-class"><span class="hljs-keyword">class</span></span>=<span class="hljs-string">"java"</span>&gt;<span class="hljs-keyword">package</span> com.christopherbiscardi.robospicetest;

<span class="hljs-keyword">import</span> com.google.api.client.util.Key;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Reddit</span> </span>{
    <span class="hljs-annotation">@Key</span>
    <span class="hljs-keyword">private</span> String kind;
    <span class="hljs-annotation">@Key</span>
    <span class="hljs-keyword">private</span> RedditData data;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Reddit</span><span class="hljs-params">()</span> </span>{
    }```

Then define some basic getters <span class="hljs-keyword">for</span> when we are dealing with our request’s response.

</code></pre>
<p><code class="java"> public String getKind() {
return this.kind;
}</p>
<pre><code>public RedditData getData() {
    return this.data;
}
</code></pre>
<pre><code>
<span class="hljs-built_in">and</span> override some utility <span class="hljs-built_in">function</span><span class="hljs-variable">s:</span>

</code></pre>
<p><code class="java"> @Override
public int hashCode() {
final int prime = 31;
int result = 1;
result = prime * result + ( kind == null ? 0 : kind.hashCode() ) + ( data == null ? 0 : data.hashCode() );
return result;
}</p>
<pre><code>@Override
public boolean equals( Object obj ) {
    if ( this == obj ) {
        return true;
    }
    if ( obj == null ) {
        return false;
    }
    if ( getClass() != obj.getClass() ) {
        return false;
    }
    Reddit other = (Reddit) obj;
    if ( kind == null ) {
        if ( other.kind != null ) {
            return false;
        }
    } else if ( !kind.equals( other.kind ) ) {
        return false;
    }
    return true;
}

@Override
public String toString() {
    return &quot;Reddit [kind=&quot; + kind + &quot; &quot; + data + &quot;]&quot;;
}
</code></pre>
<p>}</p>
<pre><code>
The model <span class="hljs-keyword">files</span> will <span class="hljs-keyword">all</span> follow this same forma<span class="hljs-variable">t:</span> @Key definitions, getters, utilities.

Our final model (`RedditListing.java`) <span class="hljs-keyword">is</span> where we are getting the content we care about. We don’<span class="hljs-keyword">t</span> have <span class="hljs-keyword">to</span> include `@Key` <span class="hljs-keyword">for</span> every key in our JSON response, <span class="hljs-keyword">so</span> we’<span class="hljs-keyword">ll</span> just grab the ones we care abou<span class="hljs-variable">t:</span>

</code></pre>
<p><code class="java"> @Key
private String domain;
@Key
private String author;
@Key
private String permalink;
@Key
private String title;```</p>
<h4>SpiceRequestReddit.java</h4>
<p>To finish off our classes, we’ll create a SpiceRequest that takes a string (our subreddit) and returns a <code>Reddit</code>.</p>
<pre><code>&lt;code <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"java"</span> style=<span class="hljs-string">"overflow-x:auto"</span>&gt;<span class="hljs-keyword">package</span> com.christopherbiscardi.robospicetest;

<span class="hljs-keyword">import</span> java.io.<span class="hljs-type">IOException</span>;

<span class="hljs-keyword">import</span> roboguice.util.temp.<span class="hljs-type">Ln</span>;

<span class="hljs-keyword">import</span> com.google.api.client.http.<span class="hljs-type">GenericUrl</span>;
<span class="hljs-keyword">import</span> com.google.api.client.http.<span class="hljs-type">HttpRequest</span>;
<span class="hljs-keyword">import</span> com.google.api.client.json.jackson.<span class="hljs-type">JacksonFactory</span>;
<span class="hljs-keyword">import</span> com.octo.android.robospice.request.googlehttpclient.<span class="hljs-type">GoogleHttpClientSpiceRequest</span>;

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SpiceRequestReddit</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">GoogleHttpClientSpiceRequest&lt;reddit&gt;</span> {</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> baseUrl;

    public <span class="hljs-type">SpiceRequestReddit</span>( <span class="hljs-type">String</span> subreddit ) {
        <span class="hljs-keyword">super</span>( <span class="hljs-type">Reddit</span>.<span class="hljs-keyword">class</span> );
        <span class="hljs-keyword">this</span>.baseUrl = <span class="hljs-type">String</span>.format( <span class="hljs-string">"http://www.reddit.com/r/%s.json"</span>, subreddit );
    }

    <span class="hljs-annotation">@Override</span>
    public <span class="hljs-type">Reddit</span> loadDataFromNetwork() <span class="hljs-keyword">throws</span> <span class="hljs-type">IOException</span> {
        <span class="hljs-type">Ln</span>.d( <span class="hljs-string">"Call web service "</span> + baseUrl );
        <span class="hljs-type">HttpRequest</span> request = getHttpRequestFactory()<span class="hljs-comment">//</span>
                .buildGetRequest( <span class="hljs-keyword">new</span> <span class="hljs-type">GenericUrl</span>( baseUrl ) );
        request.setParser( <span class="hljs-keyword">new</span> <span class="hljs-type">JacksonFactory</span>().createJsonObjectParser() );
        <span class="hljs-keyword">return</span> request.execute().parseAs( getResultType() );
    }
}&lt;/reddit&gt;```


## <span class="hljs-type">Calling</span> the <span class="hljs-type">API</span>

<span class="hljs-type">In</span> `<span class="hljs-type">MainActivity</span>.java` we need to add some code to execute the request:

<span class="hljs-type">We</span> need to extend our `<span class="hljs-type">MainActivity</span>` from `<span class="hljs-type">BaseSpiceActivity</span>`

`&lt;code <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"java"</span>&gt;public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> <span class="hljs-title">BaseSpiceActivity</span> {</span>`

<span class="hljs-type">Add</span> a <span class="hljs-keyword">new</span> `<span class="hljs-type">SpiceRequestReddit</span>`

`&lt;code <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"java"</span>&gt;<span class="hljs-keyword">private</span> <span class="hljs-type">SpiceRequestReddit</span> spiceRequestReddit;`

<span class="hljs-type">Instantiate</span> it <span class="hljs-keyword">with</span> the <span class="hljs-type">Riak</span> subreddit;

`&lt;code <span class="hljs-class"><span class="hljs-keyword">class</span>=</span><span class="hljs-string">"java"</span>&gt;spiceRequestReddit = <span class="hljs-keyword">new</span> <span class="hljs-type">SpiceRequestReddit</span>( <span class="hljs-string">"Riak"</span> );`

and implement our <span class="hljs-type">ResultHandler</span> <span class="hljs-class"><span class="hljs-keyword">class</span>:</span>

</code></pre>
<p><code class="java" style="overflow-x:auto">public final class RedditSpiceRequestListener implements RequestListener {</p>
<pre><code>    @Override
    public void onRequestFailure( SpiceException spiceException ) {
        Toast.makeText( MainActivity.this, &quot;failure&quot;, Toast.LENGTH_SHORT ).show();
    }

    @Override
    public void onRequestSuccess( final Reddit result ) {
        Toast.makeText( MainActivity.this, &quot;success&quot;, Toast.LENGTH_SHORT ).show();
        Log.e(&quot;TEST&quot;,result.getData().toString());
        Log.e(&quot;TEST&quot;,result.getData().getChildren().get(0).getData().getTitle());
    }
}```
</code></pre>
<p>We’ve just implemented a simple log to view the data, but we could have added it to an ArrayAdapter and displayed it in a ListView.</p>
<p>Finally, we override the <code>onStart()</code> method to actually make the request.</p>
<pre><code>&lt;code class=<span class="hljs-string">"java"</span>&gt;@Override
    protected void onStart() {
        super.onStart()<span class="hljs-comment">;</span>

        setProgressBarIndeterminate( <span class="hljs-literal">false</span> )<span class="hljs-comment">;</span>
        setProgressBarVisibility( <span class="hljs-literal">true</span> )<span class="hljs-comment">;</span>

        getSpiceManager().execute( spiceRequestReddit, <span class="hljs-string">"json"</span>, DurationInMillis.ONE_MINUTE, new RedditSpiceRequestListener() )<span class="hljs-comment">;</span>
    }<span class="hljs-escape">``</span><span class="hljs-escape">`
</span>

## AndroidManifest.xml

Now that’s all the code we need to write, but we still need to register our service <span class="hljs-literal">and</span> permissions in <span class="hljs-escape">`A</span>ndroidManifest.xml<span class="hljs-escape">`.</span> Notice we’ve added three <span class="hljs-escape">`u</span>ses-permission<span class="hljs-escape">` </span>nodes <span class="hljs-literal">and</span> <span class="hljs-literal">a</span> <span class="hljs-escape">`s</span>ervice<span class="hljs-escape">` </span>node.

</code></pre>
<p><code class="xml" style="overflow-x:auto"><?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="com.christopherbiscardi.robospicetest"
    android:versionCode="1"
    android:versionName="1.0" ></p>
<pre><code>&lt;uses-sdk
    android:minSdkVersion=&quot;8&quot;
    android:targetSdkVersion=&quot;17&quot; /&gt;

&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.ACCESS_NETWORK_STATE&quot; /&gt;
&lt;uses-permission android:name=&quot;android.permission.ACCESS_WIFI_STATE&quot; /&gt;

&lt;application
    android:allowBackup=&quot;true&quot;
    android:icon=&quot;@drawable/ic_launcher&quot;
    android:label=&quot;@string/app_name&quot;
    android:theme=&quot;@style/AppTheme&quot; &gt;
    &lt;activity
        android:name=&quot;com.christopherbiscardi.robospicetest.MainActivity&quot;
        android:label=&quot;@string/app_name&quot; &gt;
        &lt;intent-filter&gt;
            &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

            &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
        &lt;/intent-filter&gt;
    &lt;/activity&gt;

    &lt;service
        android:name=&quot;com.octo.android.robospice.JacksonGoogleHttpClientSpiceService&quot;
        android:exported=&quot;false&quot; /&gt;
&lt;/application&gt;
</code></pre>
<p></manifest>```</p>
<h2>Fin</h2>
<p>Now we can run the app and see the result (success or failure) pop up as a Toast as well as viewing the actual data in LogCat.</p>
<p>Check out the github repository <a href="https://github.com/ChristopherBiscardi/robospice-googlehttpclient-example">here</a></p>
</div><em data-reactid=".rzwz1jbjsw.2.1.0.0.1"><span data-reactid=".rzwz1jbjsw.2.1.0.0.1.0">Posted </span><span data-reactid=".rzwz1jbjsw.2.1.0.0.1.1">January 27, 2014</span></em><hr data-reactid=".rzwz1jbjsw.2.1.0.0.2"><noscript data-reactid=".rzwz1jbjsw.2.1.0.0.3"></noscript><p data-reactid=".rzwz1jbjsw.2.1.0.0.4"><img src="/headshot.png" data-reactid=".rzwz1jbjsw.2.1.0.0.4.0"><span data-reactid=".rzwz1jbjsw.2.1.0.0.4.1">Written by </span><strong data-reactid=".rzwz1jbjsw.2.1.0.0.4.2">Chris Biscardi</strong><span data-reactid=".rzwz1jbjsw.2.1.0.0.4.3"> who lives and works in San Francisco building useful things. </span><a href="https://twitter.com/chrisbiscardi" data-reactid=".rzwz1jbjsw.2.1.0.0.4.4">Follow on Twitter</a></p></div></div><div data-reactid=".rzwz1jbjsw.2.1.1"></div></div></div></div></div><script src="/bundle.js"></script></body></html>