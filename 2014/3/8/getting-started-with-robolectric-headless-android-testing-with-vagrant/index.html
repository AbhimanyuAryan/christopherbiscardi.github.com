<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, initial-scale=1"/><title data-react-helmet="true">Getting Started with Robolectric: Headless Android Testing with Vagrant</title><meta data-react-helmet="true" property="description" content="In this post we will go over how to set up the sample project for Robolectric,
run, test and deploy to a device in a headless vagrant…"/><meta data-react-helmet="true" property="og:title" content="Getting Started with Robolectric: Headless Android Testing with Vagrant"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:url" content="http://christopherbiscardi.com/2014/3/8/getting-started-with-robolectric-headless-android-testing-with-vagrant/"/><meta data-react-helmet="true" property="og:description" content="In this post we will go over how to set up the sample project for Robolectric,
run, test and deploy to a device in a headless vagrant…"/><meta data-react-helmet="true" property="og:image" content="http://christopherbiscardi.comnull"/><meta data-react-helmet="true" property="twitter:card" content="summary"/><meta data-react-helmet="true" property="twitter:title" content="Getting Started with Robolectric: Headless Android Testing with Vagran"/><meta data-react-helmet="true" property="twitter:description" content="In this post we will go over how to set up the sample project for Robolectric,
run, test and deploy to a device in a headless vagrant…"/><meta data-react-helmet="true" property="twitter:url" content="http://christopherbiscardi.com/2014/3/8/getting-started-with-robolectric-headless-android-testing-with-vagrant/"/><link rel="stylesheet" type="text/css" href="/styles.f25bf9e6682280946ba2e441a544b407.css"/></head><body class="landing-page"><div id="content"><div data-reactroot="" data-reactid="1" data-react-checksum="1334459139"><div class="Nav__wrapper___u7BUA" data-reactid="2"><nav class="Nav__nav___1e2Pp" data-reactid="3"><a class="Nav__logoWrapper___35yvY" href="/" data-reactid="4"><img class="Nav__logo___sw4O9" src="/69305db2985e926d498b513a21d28383.png" data-reactid="5"/></a><ul class="Nav__items___1oDCD" data-reactid="6"><li data-reactid="7"><a class="Nav__itemLink___H6Isv" href="/posts/" data-reactid="8">Posts</a></li><li data-reactid="9"><a href="https://github.com/ChristopherBiscardi/ama/issues?q=is%3Aissue+is%3Aclosed" class="Nav__itemLink___H6Isv" data-reactid="10">AMA</a></li><li data-reactid="11"><a class="Nav__itemLink___H6Isv" href="/books/" data-reactid="12">Books</a></li><li data-reactid="13"><a class="Nav__itemLink___H6Isv" href="/projects/" data-reactid="14">Projects</a></li><li data-reactid="15"><a class="Nav__itemLink___H6Isv" href="/about/" data-reactid="16">About</a></li></ul></nav></div><div data-reactid="17"><div class="Post__page___15ves" data-reactid="18"><!-- react-empty: 19 --><div class="Post__container___f_rKX" data-reactid="20"><div class="Post__singleColumn___tYK8R" data-reactid="21"><h1 class="Post__title___2I6DZ" data-reactid="22">Getting Started with Robolectric: Headless Android Testing with Vagrant</h1><div class="Post__meta___1fVoc" data-reactid="23"><!-- react-text: 24 -->Mar 8th, 2014<!-- /react-text --><!-- react-text: 25 --> · <!-- /react-text --><!-- react-text: 26 -->3<!-- /react-text --><!-- react-text: 27 --> minute read<!-- /react-text --></div></div></div><div class="Post__container___f_rKX" data-reactid="28"><div class="Post__singleColumn___tYK8R" data-reactid="29"><div data-reactid="30"><p>In this post we will go over how to set up the sample project for Robolectric,
run, test and deploy to a device in a headless vagrant environment.</p>
<h2 id="sample-app">Sample App</h2>
<p>Clone the sample app from the <a href="https://github.com/robolectric/RobolectricSample">github
repo</a></p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>git clone git@github.com:robolectric/RobolectricSample.git
</code></pre>
<h2 id="vagrantfile">Vagrantfile</h2>
<p>Here is our Vagrantfile. We’ll need to add the <code>precise64</code> base box to our
system. also availible as a
<a href="https://gist.github.com/ChristopherBiscardi/9383725">Gist</a></p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>vagrant box add precise64 http://files.vagrantup.com/precise64.box
</code></pre>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-comment___UYk12"># -*- mode: ruby -*-</span>
<span class="highlight__hljs-comment___UYk12"># vi: set ft=ruby :</span>

<span class="highlight__hljs-comment___UYk12"># Vagrantfile API/syntax version. Don't touch unless you know what you're doing!</span>
VAGRANTFILE_API_VERSION = <span class="highlight__hljs-string___1SffY">"2"</span>

Vagrant.configure(VAGRANTFILE_API_VERSION) <span class="highlight__hljs-keyword___som98">do</span> <span class="hljs-params">|config|</span>
  config.vm.box = <span class="highlight__hljs-string___1SffY">"precise64"</span>
  config.vm.provision <span class="highlight__hljs-string___1SffY">"shell"</span>, <span class="highlight__hljs-symbol___mdaTG">path:</span> <span class="highlight__hljs-string___1SffY">"vagrant-android-build.sh"</span>
  config.vm.provider <span class="highlight__hljs-symbol___mdaTG">:virtualbox</span> <span class="highlight__hljs-keyword___som98">do</span> <span class="hljs-params">|vb|</span>
    vb.customize [<span class="highlight__hljs-string___1SffY">'modifyvm'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--usb'</span>, <span class="highlight__hljs-string___1SffY">'on'</span>]
    vb.customize [<span class="highlight__hljs-string___1SffY">'usbfilter'</span>, <span class="highlight__hljs-string___1SffY">'add'</span>, <span class="highlight__hljs-string___1SffY">'0'</span>, <span class="highlight__hljs-string___1SffY">'--target'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--name'</span>, <span class="highlight__hljs-string___1SffY">'1197123b'</span>, <span class="highlight__hljs-string___1SffY">'--vendorid'</span>, <span class="highlight__hljs-string___1SffY">'0x04e8'</span>]
    vb.customize [<span class="highlight__hljs-string___1SffY">'usbfilter'</span>, <span class="highlight__hljs-string___1SffY">'add'</span>, <span class="highlight__hljs-string___1SffY">'0'</span>, <span class="highlight__hljs-string___1SffY">'--target'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--name'</span>, <span class="highlight__hljs-string___1SffY">'android'</span>, <span class="highlight__hljs-string___1SffY">'--vendorid'</span>, <span class="highlight__hljs-string___1SffY">'0x18d1'</span>]
  <span class="highlight__hljs-keyword___som98">end</span>
<span class="highlight__hljs-keyword___som98">end</span>
</code></pre>
<p>and the Vagrant build script. The build script downloads and installs ADT and
Maven.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>apt-get update -y
apt-get install openjdk-7-jdk unzip -y
<span class="highlight__hljs-comment___UYk12"># For maven-plugin</span>
apt-get install lib32z1-dev bison flex lib32ncurses5-dev libx11-dev gperf g++-multilib -y
<span class="highlight__hljs-comment___UYk12"># Setup Android SDK</span>
sudo -u vagrant wget http://dl.google.com/android/adt/adt-bundle-linux-x86_64-20131030.zip
sudo -u vagrant unzip adt-bundle-linux-x86_64-20131030.zip
<span class="highlight__hljs-comment___UYk12"># Add Android SDK to PATH</span>
sudo -u vagrant <span class="highlight__hljs-built_in___3uuyR">echo</span> <span class="highlight__hljs-built_in___3uuyR">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/tools:\<span class="highlight__hljs-variable___1-KRy">$PATH</span> &gt;&gt; /home/vagrant/.bashrc
sudo -u vagrant <span class="highlight__hljs-built_in___3uuyR">echo</span> <span class="highlight__hljs-built_in___3uuyR">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/platform-tools:\<span class="highlight__hljs-variable___1-KRy">$PATH</span> &gt;&gt; /home/vagrant/.bashrc

<span class="highlight__hljs-comment___UYk12"># Maven</span>
sudo -u vagrant wget http://download.nextag.com/apache/maven/maven-3/3.2.1/binaries/apache-maven-3.2.1-bin.tar.gz
sudo -u vagrant tar -xvzf apache-maven-3.2.1-bin.tar.gz
<span class="highlight__hljs-comment___UYk12"># Add Maven to PATH</span>
sudo -u vagrant <span class="highlight__hljs-built_in___3uuyR">echo</span> <span class="highlight__hljs-built_in___3uuyR">export</span> PATH=/home/vagrant/apache-maven-3.2.1/bin:\<span class="highlight__hljs-variable___1-KRy">$PATH</span> &gt;&gt; /home/vagrant/.bashrc

<span class="highlight__hljs-comment___UYk12"># Install API 16 (sample project needs it)</span>
<span class="highlight__hljs-comment___UYk12"># echo "y" is a hack to accept the license</span>
sudo -u vagrant <span class="highlight__hljs-built_in___3uuyR">echo</span> <span class="highlight__hljs-string___1SffY">"y"</span> | /home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/tools/android update sdk -t 6 --no-ui -y
<span class="highlight__hljs-comment___UYk12"># ANDROID_HOME is for Maven</span>
sudo -u vagrant <span class="highlight__hljs-built_in___3uuyR">echo</span> <span class="highlight__hljs-built_in___3uuyR">export</span> ANDROID_HOME=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/ &gt;&gt; /home/vagrant/.bashrc
</code></pre>
<h2 id="path-and-android-home">Path and ANDROID_HOME</h2>
<p>We need a few thing on our path, all of which are included in our Vagrant build
script (Android tools, Android platform-tools, Maven and ANDROID_HOME)</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-built_in___3uuyR">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/tools:\<span class="highlight__hljs-variable___1-KRy">$PATH</span>
<span class="highlight__hljs-built_in___3uuyR">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/platform-tools:\<span class="highlight__hljs-variable___1-KRy">$PATH</span>
<span class="highlight__hljs-built_in___3uuyR">export</span> PATH=/home/vagrant/apache-maven-3.2.1/bin:\<span class="highlight__hljs-variable___1-KRy">$PATH</span>
<span class="highlight__hljs-built_in___3uuyR">export</span> ANDROID_HOME=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/
</code></pre>
<h2 id="vagrant-up">Vagrant Up</h2>
<p>Simply copy the <code>Vagrantfile</code> and <code>vagrant-android-build.sh</code> into the sample
project’s root folder. Then <code>cd</code> into that folder and run <code>vagrant up</code> to boot
the machine. If you don’t have Vagrant and VirtualBox,
<a href="http://www.vagrantup.com/">here</a> and <a href="https://www.virtualbox.org/">here</a> are
the respective links.</p>
<p>Note that it may be necessary to run the command to update the Android SDK
manually due to the licenses.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>vagrant ssh
android update sdk -t 6 --no-ui -y
</code></pre>
<h2 id="running-the-tests">Running the Tests</h2>
<p>We can run the tests inside the vm using maven:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>vagrant ssh
<span class="highlight__hljs-built_in___3uuyR">cd</span> /vagrant
mvn clean <span class="highlight__hljs-built_in___3uuyR">test</span>
</code></pre>
<p>Which will give us output that looks like this:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>Results :

Tests run: 87, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 28.917 s
[INFO] Finished at: 2014-03-06T06:19:39+00:00
[INFO] Final Memory: 23M/57M
[INFO] ------------------------------------------------------------------------
</code></pre>
<p>Run <code>exit</code> to get out of the vm.</p>
<h2 id="connecting-test-devices-to-the-vm">Connecting Test Devices to the VM</h2>
<p>With <code>VBoxManage</code> and devices connected, we can allow (all?) of them using the
following <code>usbfilter</code> in our <code>Vagrantfile</code></p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>config.vm.provider <span class="highlight__hljs-symbol___mdaTG">:virtualbox</span> <span class="highlight__hljs-keyword___som98">do</span> <span class="hljs-params">|vb|</span>
    vb.customize [<span class="highlight__hljs-string___1SffY">'modifyvm'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--usb'</span>, <span class="highlight__hljs-string___1SffY">'on'</span>]
    vb.customize [<span class="highlight__hljs-string___1SffY">'usbfilter'</span>, <span class="highlight__hljs-string___1SffY">'add'</span>, <span class="highlight__hljs-string___1SffY">'0'</span>, <span class="highlight__hljs-string___1SffY">'--target'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--name'</span>, <span class="highlight__hljs-string___1SffY">'android'</span>, <span class="highlight__hljs-string___1SffY">'--vendorid'</span>, <span class="highlight__hljs-string___1SffY">'0x18d1'</span>]
  <span class="highlight__hljs-keyword___som98">end</span>
</code></pre>
<p>Alternatively, we can list all connected usbhosts and select a specific device
as such:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>VBoxManage list usbhost
</code></pre>
<p>Which gives us a list of these:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>UUID:               6316e123-b702-4155-9703-c2015d014237
VendorId:           0x18d1 (18D1)
ProductId:          0xd002 (D002)
Revision:           2.40 (0240)
Port:               6
USB version/speed:  0/2
Manufacturer:       asus
Product:            Nexus 7
SerialNumber:       07d99c71
Address:            p=0xd002;v=0x18d1;s=0x000000006321cfbd;l=0x20260000
Current State:      Busy
</code></pre>
<p>Find your Android device and use these parameters to change our Vagrantfile:</p>
<p>SerialNumber -&gt; –name
VendorId -&gt; –vendorid</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>config.vm.provider <span class="highlight__hljs-symbol___mdaTG">:virtualbox</span> <span class="highlight__hljs-keyword___som98">do</span> <span class="hljs-params">|vb|</span>
    vb.customize [<span class="highlight__hljs-string___1SffY">'modifyvm'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--usb'</span>, <span class="highlight__hljs-string___1SffY">'on'</span>]
    vb.customize [<span class="highlight__hljs-string___1SffY">'usbfilter'</span>, <span class="highlight__hljs-string___1SffY">'add'</span>, <span class="highlight__hljs-string___1SffY">'0'</span>, <span class="highlight__hljs-string___1SffY">'--target'</span>, <span class="highlight__hljs-symbol___mdaTG">:id</span>, <span class="highlight__hljs-string___1SffY">'--name'</span>, <span class="highlight__hljs-string___1SffY">'1197123b'</span>, <span class="highlight__hljs-string___1SffY">'--vendorid'</span>, <span class="highlight__hljs-string___1SffY">'0x04e8'</span>]
  <span class="highlight__hljs-keyword___som98">end</span>
</code></pre>
<p>Remember to <code>vagrant reload</code> after changing network settings in the
<code>Vagrantfile</code>. Some devices may also need to be unplugged and plugged back in
for the VM to see them.</p>
<h2 id="deploying">Deploying</h2>
<p>Simply run adb inside the vm to see the connected devices:</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>vagrant ssh
sudo adb devices
</code></pre>
<p>If you see an unauthorized message like the one below, it is likely that you
didn’t start the adb server as root (which will prevent the RSA authorization
from popping up).</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code>* daemon not running. starting it now on port 5037 *
* daemon started successfully *
List of devices attached
????????????	no permissions&lt;/pre&gt;&lt;p&gt;Otherwise we should see a list of devices as below after authorizing the devices when the RSA dialog pops up on each device.&lt;/p&gt;&lt;pre&gt;&lt;code class=<span class="highlight__hljs-string___1SffY">"&gt;List of devices attached
07d99c71	device
2d605528	device
</span></code></pre>
<p>We can now install the app on our devices from inside the vm using maven.</p>
<pre class="highlight__hljs___FzKxy index__p2___65FBl"><code><span class="highlight__hljs-built_in___3uuyR">cd</span> /vagrant
mvn clean install &amp;&amp; mvn android:deploy
</code></pre>
<h2 id="fin">Fin</h2>
<p>That’s it. The app should be installed on your connected devices. It won’t start
automatically, but you can navigate to the newly installed <code>Robolectric Sample</code>
app and start it up.</p>
</div></div></div></div></div></div></div><script charset="UTF-8">window.__APOLLO_STATE__={"apollo":{"data":{"$ROOT_QUERY.root.post({\"slug\":\"getting-started-with-robolectric-headless-android-testing-with-vagrant\"})":{"body":"<p>In this post we will go over how to set up the sample project for Robolectric,\nrun, test and deploy to a device in a headless vagrant environment.</p>\n<h2 id=\"sample-app\">Sample App</h2>\n<p>Clone the sample app from the <a href=\"https://github.com/robolectric/RobolectricSample\">github\nrepo</a></p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>git clone git@github.com:robolectric/RobolectricSample.git\n</code></pre>\n<h2 id=\"vagrantfile\">Vagrantfile</h2>\n<p>Here is our Vagrantfile. We’ll need to add the <code>precise64</code> base box to our\nsystem. also availible as a\n<a href=\"https://gist.github.com/ChristopherBiscardi/9383725\">Gist</a></p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>vagrant box add precise64 http://files.vagrantup.com/precise64.box\n</code></pre>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-comment___UYk12\"># -*- mode: ruby -*-</span>\n<span class=\"highlight__hljs-comment___UYk12\"># vi: set ft=ruby :</span>\n\n<span class=\"highlight__hljs-comment___UYk12\"># Vagrantfile API/syntax version. Don't touch unless you know what you're doing!</span>\nVAGRANTFILE_API_VERSION = <span class=\"highlight__hljs-string___1SffY\">\"2\"</span>\n\nVagrant.configure(VAGRANTFILE_API_VERSION) <span class=\"highlight__hljs-keyword___som98\">do</span> <span class=\"hljs-params\">|config|</span>\n  config.vm.box = <span class=\"highlight__hljs-string___1SffY\">\"precise64\"</span>\n  config.vm.provision <span class=\"highlight__hljs-string___1SffY\">\"shell\"</span>, <span class=\"highlight__hljs-symbol___mdaTG\">path:</span> <span class=\"highlight__hljs-string___1SffY\">\"vagrant-android-build.sh\"</span>\n  config.vm.provider <span class=\"highlight__hljs-symbol___mdaTG\">:virtualbox</span> <span class=\"highlight__hljs-keyword___som98\">do</span> <span class=\"hljs-params\">|vb|</span>\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'modifyvm'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--usb'</span>, <span class=\"highlight__hljs-string___1SffY\">'on'</span>]\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'usbfilter'</span>, <span class=\"highlight__hljs-string___1SffY\">'add'</span>, <span class=\"highlight__hljs-string___1SffY\">'0'</span>, <span class=\"highlight__hljs-string___1SffY\">'--target'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--name'</span>, <span class=\"highlight__hljs-string___1SffY\">'1197123b'</span>, <span class=\"highlight__hljs-string___1SffY\">'--vendorid'</span>, <span class=\"highlight__hljs-string___1SffY\">'0x04e8'</span>]\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'usbfilter'</span>, <span class=\"highlight__hljs-string___1SffY\">'add'</span>, <span class=\"highlight__hljs-string___1SffY\">'0'</span>, <span class=\"highlight__hljs-string___1SffY\">'--target'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--name'</span>, <span class=\"highlight__hljs-string___1SffY\">'android'</span>, <span class=\"highlight__hljs-string___1SffY\">'--vendorid'</span>, <span class=\"highlight__hljs-string___1SffY\">'0x18d1'</span>]\n  <span class=\"highlight__hljs-keyword___som98\">end</span>\n<span class=\"highlight__hljs-keyword___som98\">end</span>\n</code></pre>\n<p>and the Vagrant build script. The build script downloads and installs ADT and\nMaven.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>apt-get update -y\napt-get install openjdk-7-jdk unzip -y\n<span class=\"highlight__hljs-comment___UYk12\"># For maven-plugin</span>\napt-get install lib32z1-dev bison flex lib32ncurses5-dev libx11-dev gperf g++-multilib -y\n<span class=\"highlight__hljs-comment___UYk12\"># Setup Android SDK</span>\nsudo -u vagrant wget http://dl.google.com/android/adt/adt-bundle-linux-x86_64-20131030.zip\nsudo -u vagrant unzip adt-bundle-linux-x86_64-20131030.zip\n<span class=\"highlight__hljs-comment___UYk12\"># Add Android SDK to PATH</span>\nsudo -u vagrant <span class=\"highlight__hljs-built_in___3uuyR\">echo</span> <span class=\"highlight__hljs-built_in___3uuyR\">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/tools:\\<span class=\"highlight__hljs-variable___1-KRy\">$PATH</span> &gt;&gt; /home/vagrant/.bashrc\nsudo -u vagrant <span class=\"highlight__hljs-built_in___3uuyR\">echo</span> <span class=\"highlight__hljs-built_in___3uuyR\">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/platform-tools:\\<span class=\"highlight__hljs-variable___1-KRy\">$PATH</span> &gt;&gt; /home/vagrant/.bashrc\n\n<span class=\"highlight__hljs-comment___UYk12\"># Maven</span>\nsudo -u vagrant wget http://download.nextag.com/apache/maven/maven-3/3.2.1/binaries/apache-maven-3.2.1-bin.tar.gz\nsudo -u vagrant tar -xvzf apache-maven-3.2.1-bin.tar.gz\n<span class=\"highlight__hljs-comment___UYk12\"># Add Maven to PATH</span>\nsudo -u vagrant <span class=\"highlight__hljs-built_in___3uuyR\">echo</span> <span class=\"highlight__hljs-built_in___3uuyR\">export</span> PATH=/home/vagrant/apache-maven-3.2.1/bin:\\<span class=\"highlight__hljs-variable___1-KRy\">$PATH</span> &gt;&gt; /home/vagrant/.bashrc\n\n<span class=\"highlight__hljs-comment___UYk12\"># Install API 16 (sample project needs it)</span>\n<span class=\"highlight__hljs-comment___UYk12\"># echo \"y\" is a hack to accept the license</span>\nsudo -u vagrant <span class=\"highlight__hljs-built_in___3uuyR\">echo</span> <span class=\"highlight__hljs-string___1SffY\">\"y\"</span> | /home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/tools/android update sdk -t 6 --no-ui -y\n<span class=\"highlight__hljs-comment___UYk12\"># ANDROID_HOME is for Maven</span>\nsudo -u vagrant <span class=\"highlight__hljs-built_in___3uuyR\">echo</span> <span class=\"highlight__hljs-built_in___3uuyR\">export</span> ANDROID_HOME=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/ &gt;&gt; /home/vagrant/.bashrc\n</code></pre>\n<h2 id=\"path-and-android-home\">Path and ANDROID_HOME</h2>\n<p>We need a few thing on our path, all of which are included in our Vagrant build\nscript (Android tools, Android platform-tools, Maven and ANDROID_HOME)</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-built_in___3uuyR\">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/tools:\\<span class=\"highlight__hljs-variable___1-KRy\">$PATH</span>\n<span class=\"highlight__hljs-built_in___3uuyR\">export</span> PATH=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/platform-tools:\\<span class=\"highlight__hljs-variable___1-KRy\">$PATH</span>\n<span class=\"highlight__hljs-built_in___3uuyR\">export</span> PATH=/home/vagrant/apache-maven-3.2.1/bin:\\<span class=\"highlight__hljs-variable___1-KRy\">$PATH</span>\n<span class=\"highlight__hljs-built_in___3uuyR\">export</span> ANDROID_HOME=/home/vagrant/adt-bundle-linux-x86_64-20131030/sdk/\n</code></pre>\n<h2 id=\"vagrant-up\">Vagrant Up</h2>\n<p>Simply copy the <code>Vagrantfile</code> and <code>vagrant-android-build.sh</code> into the sample\nproject’s root folder. Then <code>cd</code> into that folder and run <code>vagrant up</code> to boot\nthe machine. If you don’t have Vagrant and VirtualBox,\n<a href=\"http://www.vagrantup.com/\">here</a> and <a href=\"https://www.virtualbox.org/\">here</a> are\nthe respective links.</p>\n<p>Note that it may be necessary to run the command to update the Android SDK\nmanually due to the licenses.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>vagrant ssh\nandroid update sdk -t 6 --no-ui -y\n</code></pre>\n<h2 id=\"running-the-tests\">Running the Tests</h2>\n<p>We can run the tests inside the vm using maven:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>vagrant ssh\n<span class=\"highlight__hljs-built_in___3uuyR\">cd</span> /vagrant\nmvn clean <span class=\"highlight__hljs-built_in___3uuyR\">test</span>\n</code></pre>\n<p>Which will give us output that looks like this:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>Results :\n\nTests run: 87, Failures: 0, Errors: 0, Skipped: 0\n\n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD SUCCESS\n[INFO] ------------------------------------------------------------------------\n[INFO] Total time: 28.917 s\n[INFO] Finished at: 2014-03-06T06:19:39+00:00\n[INFO] Final Memory: 23M/57M\n[INFO] ------------------------------------------------------------------------\n</code></pre>\n<p>Run <code>exit</code> to get out of the vm.</p>\n<h2 id=\"connecting-test-devices-to-the-vm\">Connecting Test Devices to the VM</h2>\n<p>With <code>VBoxManage</code> and devices connected, we can allow (all?) of them using the\nfollowing <code>usbfilter</code> in our <code>Vagrantfile</code></p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>config.vm.provider <span class=\"highlight__hljs-symbol___mdaTG\">:virtualbox</span> <span class=\"highlight__hljs-keyword___som98\">do</span> <span class=\"hljs-params\">|vb|</span>\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'modifyvm'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--usb'</span>, <span class=\"highlight__hljs-string___1SffY\">'on'</span>]\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'usbfilter'</span>, <span class=\"highlight__hljs-string___1SffY\">'add'</span>, <span class=\"highlight__hljs-string___1SffY\">'0'</span>, <span class=\"highlight__hljs-string___1SffY\">'--target'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--name'</span>, <span class=\"highlight__hljs-string___1SffY\">'android'</span>, <span class=\"highlight__hljs-string___1SffY\">'--vendorid'</span>, <span class=\"highlight__hljs-string___1SffY\">'0x18d1'</span>]\n  <span class=\"highlight__hljs-keyword___som98\">end</span>\n</code></pre>\n<p>Alternatively, we can list all connected usbhosts and select a specific device\nas such:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>VBoxManage list usbhost\n</code></pre>\n<p>Which gives us a list of these:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>UUID:               6316e123-b702-4155-9703-c2015d014237\nVendorId:           0x18d1 (18D1)\nProductId:          0xd002 (D002)\nRevision:           2.40 (0240)\nPort:               6\nUSB version/speed:  0/2\nManufacturer:       asus\nProduct:            Nexus 7\nSerialNumber:       07d99c71\nAddress:            p=0xd002;v=0x18d1;s=0x000000006321cfbd;l=0x20260000\nCurrent State:      Busy\n</code></pre>\n<p>Find your Android device and use these parameters to change our Vagrantfile:</p>\n<p>SerialNumber -&gt; –name\nVendorId -&gt; –vendorid</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>config.vm.provider <span class=\"highlight__hljs-symbol___mdaTG\">:virtualbox</span> <span class=\"highlight__hljs-keyword___som98\">do</span> <span class=\"hljs-params\">|vb|</span>\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'modifyvm'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--usb'</span>, <span class=\"highlight__hljs-string___1SffY\">'on'</span>]\n    vb.customize [<span class=\"highlight__hljs-string___1SffY\">'usbfilter'</span>, <span class=\"highlight__hljs-string___1SffY\">'add'</span>, <span class=\"highlight__hljs-string___1SffY\">'0'</span>, <span class=\"highlight__hljs-string___1SffY\">'--target'</span>, <span class=\"highlight__hljs-symbol___mdaTG\">:id</span>, <span class=\"highlight__hljs-string___1SffY\">'--name'</span>, <span class=\"highlight__hljs-string___1SffY\">'1197123b'</span>, <span class=\"highlight__hljs-string___1SffY\">'--vendorid'</span>, <span class=\"highlight__hljs-string___1SffY\">'0x04e8'</span>]\n  <span class=\"highlight__hljs-keyword___som98\">end</span>\n</code></pre>\n<p>Remember to <code>vagrant reload</code> after changing network settings in the\n<code>Vagrantfile</code>. Some devices may also need to be unplugged and plugged back in\nfor the VM to see them.</p>\n<h2 id=\"deploying\">Deploying</h2>\n<p>Simply run adb inside the vm to see the connected devices:</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>vagrant ssh\nsudo adb devices\n</code></pre>\n<p>If you see an unauthorized message like the one below, it is likely that you\ndidn’t start the adb server as root (which will prevent the RSA authorization\nfrom popping up).</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code>* daemon not running. starting it now on port 5037 *\n* daemon started successfully *\nList of devices attached\n????????????\tno permissions&lt;/pre&gt;&lt;p&gt;Otherwise we should see a list of devices as below after authorizing the devices when the RSA dialog pops up on each device.&lt;/p&gt;&lt;pre&gt;&lt;code class=<span class=\"highlight__hljs-string___1SffY\">\"&gt;List of devices attached\n07d99c71\tdevice\n2d605528\tdevice\n</span></code></pre>\n<p>We can now install the app on our devices from inside the vm using maven.</p>\n<pre class=\"highlight__hljs___FzKxy index__p2___65FBl\"><code><span class=\"highlight__hljs-built_in___3uuyR\">cd</span> /vagrant\nmvn clean install &amp;&amp; mvn android:deploy\n</code></pre>\n<h2 id=\"fin\">Fin</h2>\n<p>That’s it. The app should be installed on your connected devices. It won’t start\nautomatically, but you can navigate to the newly installed <code>Robolectric Sample</code>\napp and start it up.</p>\n","attributes":{"type":"id","id":"$ROOT_QUERY.root.post({\"slug\":\"getting-started-with-robolectric-headless-android-testing-with-vagrant\"}).attributes","generated":true},"__typename":"BlogPost"},"$ROOT_QUERY.root.post({\"slug\":\"getting-started-with-robolectric-headless-android-testing-with-vagrant\"}).attributes":{"title":"Getting Started with Robolectric: Headless Android Testing with Vagrant","updatedAt":"Mar 8th, 2014","publishedAt":"Mar 8th, 2014","timeToRead":3,"headerImage":null,"url":"/2014/3/8/getting-started-with-robolectric-headless-android-testing-with-vagrant/","canonicalURL":null,"excerpt":"In this post we will go over how to set up the sample project for Robolectric,\nrun, test and deploy to a device in a headless vagrant…","__typename":"BlogPostAttributes"},"$ROOT_QUERY.root":{"post({\"slug\":\"getting-started-with-robolectric-headless-android-testing-with-vagrant\"})":{"type":"id","id":"$ROOT_QUERY.root.post({\"slug\":\"getting-started-with-robolectric-headless-android-testing-with-vagrant\"})","generated":true},"__typename":"Query"},"ROOT_QUERY":{"root":{"type":"id","id":"$ROOT_QUERY.root","generated":true}}}}};</script><script src="/js/client.js" charset="UTF-8"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
          ga('create', 'UA-46878058-1', 'auto');
          ga('send', 'pageview');</script></body></html>